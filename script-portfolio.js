const portfolioData = {
  fr: {
    navHome: "Accueil",
    navAbout: "Biographie",
    navPassion: "Passion",
    navStrategy: "Vision",
    navSkills: "Comp√©tences",
    navExperience: "Parcours Professionnel",
    navConnection: "Contact",
    
    greetingName: "Bonjour,\nJe suis Aina Mahery,",
    greetingRole: "Analyste strat√©gique, cr√©ateur de solutions et passionn√© par la performance durable.",
    greetingDescription: "J'ai forg√© mon expertise sur le terrain. De conseiller √† team leader, en passant par le coaching et la supervision, j'ai red√©fini chaque √©chelon pour en extraire une loi physique : la performance ne dure que si elle est structur√©e.<br><br>Aujourd‚Äôhui, j‚Äôinterviens l√† o√π la donn√©e devient un langage d‚Äôaction. Je con√ßois des syst√®mes qui √©clairent les angles morts et transforment l‚Äôinformation brute en d√©cision pure.<br><br><strong>Bienvenue dans mon √©gosyst√®me.</strong> C'est une proposition de valeur o√π la rigueur technique sert un impact intentionnel. Pensons, construisons et agissons ensemble.",
    
    aboutTitle: "MON √âGOSYST√àME",
    aboutText: "Sp√©cialiste du reporting et de la performance, j‚Äôai accompagn√© plus de 20 marques internationales pour transformer leurs donn√©es en leviers d'action imm√©diats.<br><b>Ma r√®gle d'or :</b> Je ne produis pas de l'esth√©tique pour \"embellir\" des diapositives. Je b√¢tis des outils pour transformer la donn√©e en d√©cision.<br><br>Mon architecture repose sur trois organes sp√©cialis√©s :<br><ul><li><strong>L‚ÄôAnalyse Fine :</strong> Interpr√©ter les signaux faibles, pas seulement afficher des chiffres.</li><li><strong>L‚ÄôOptimisation :</strong> Fluidifier les processus m√©tiers pour que la structure serve l'action.</li><li><strong>Le Pilotage Humain :</strong> Parce qu‚Äôune donn√©e n‚Äôa de valeur que par l'intelligence de ceux qui l'activent.</li></ul><br>Mon objectif : Que chaque dashboard soit un moteur strat√©gique, chaque limite une opportunit√© de d√©passement, et chaque engagement une performance ex√©cut√©e avec pr√©cision.",
    
    passionTitle: "MON MOTEUR DE R√âFLEXION",
    passionDescription: "Mon √©gosyst√®me ne s‚Äôarr√™te pas au bureau. Il se nourrit d‚Äôinfluences qui transforment ma vision strat√©gique.<br><ul><li>üéÆ <b>Gaming & Strat√©gie :</b> L'art de la pens√©e en arborescence. Mod√©liser des sc√©narios, anticiper les risques et improviser.</li><li>üíª <b>Code & Logique :</b> Mon laboratoire personnel. Ma√Ætriser la structure invisible derri√®re chaque interface.</li><li>üéå <b>Culture Japonaise :</b> Rigueur, esth√©tique √©pur√©e et philosophie du Kaizen (am√©lioration continue).</li><li>üéß <b>Musique & Rythme :</b> Le m√©tronome de ma productivit√©. Elle cadence mes cycles.</li><li>‚ôüÔ∏è <b>√âchecs :</b> Le terrain de la r√©flexion pure. Anticiper plusieurs coups, √©laborer des strat√©gies et transformer chaque partie en apprentissage tactique.</li></ul>Loin d'√™tre de simples loisirs, elles constituent mon infrastructure d'apprentissage continu.",
    
    strategicTitle: "MON ARCHITECTURE STRAT√âGIQUE",
    strategicText: "Mon expertise ne sort pas de manuels, elle a √©t√© forg√©e par l‚Äôobsession du r√©sultat. Je ne me contente pas de suivre des r√®gles : je cr√©e les principes et je con√ßois les syst√®mes.",
    architecture: [
      { id: "vision", title: "üëÅÔ∏è‚Äçüó®Ô∏è La Vision", content: "<b>La donn√©e comme langage.</b> Mon parcours m'a appris √† lire entre les lignes. Je ne manipule pas des chiffres : je r√©v√®le des intentions. Chaque dashboard est un levier narratif, structur√© pour transformer la donn√©e brute en langage strat√©gique." },
      { id: "ambition", title: "üöÄ L'Ambition", content: "<b>L'humain au centre de l'analyse.</b> La donn√©e sans l'humain est morte. Mon but est de transformer l'analyse en action concr√®te o√π les processus sont choisis, faisant du facteur humain une force motrice et non une variable d'ajustement." },
      { id: "demarche", title: "‚öôÔ∏è La D√©marche", content: "<b>Dompter la complexit√©.</b> L√† o√π d'autres voient des contraintes, je vois un terrain de jeu. Je con√ßois des outils qui sont des d√©clencheurs de d√©cision. Ma signature : rendre le complexe lisible, fluide et durable." },
      { id: "engagement", title: "üîí L'Engagement", content: "<b>Anticiper pour impacter.</b> J‚Äôai pilot√© des √©quipes multiculturelles. Mon engagement est une pratique : j‚Äôanticipe et je structure l√† o√π d‚Äôautres improvisent, garantissant un impact r√©el, mesurable et √©thique." },
      { id: "reperes", title: "üß≠ Les Rep√®res", content: "<b>Rigueur et Int√©grit√©.</b> L‚Äôexcellence est mon exigence quotidienne. Chaque optimisation que je livre vise une valeur identifiable et responsable, ancr√©e dans une int√©grit√© qui d√©finit ma mani√®re de piloter et d'influencer." },
      { id: "signature", title: "üß† La Signature", content: "<b>La technicit√© au service du sens.</b> Mes cr√©ations catalysent les d√©cisions. Mon travail ne se contente pas d‚Äô√™tre efficace : il laisse une empreinte durable l√† o√π la performance rencontre le sens." }
    ],

    experienceTitle: "MES √âTAPES CL√âS",
    experience: [
      { role: "Reporting & Analyse de Donn√©es ‚Äì Performance", company: "Odity Andraharo | Juin 2023 ‚Üí √† pr√©sent", tasks: ["Analyse des donn√©es & suivi des KPI pour orienter les d√©cisions", "Cr√©ation & automatisation de reportings (quotidiens, hebdos, mensuels)", "Conception de tableaux de bord dynamiques et visuels", "Collaboration avec les √©quipes pour optimiser process & performance"] },
      { role: "Superviseur d‚Äô√âquipe ‚Üí Team Leader", company: "Odity Andraharo | D√©c 2020 ‚Üí Mai 2023", tasks: ["Pilotage et supervision op√©rationnelle d‚Äôune √©quipe", "Coordination de l‚Äôactivit√© et r√©solution des cas complexes", "Formation continue & accompagnement", "Am√©lioration continue des processus"] },
      { role: "Coach Formateur", company: "Odity Andraharo | Juin 2020 ‚Üí D√©c 2020", tasks: ["Suivi des performances dans le respect qualit√© & conformit√©", "Encadrement op√©rationnel et gestion des priorit√©s", "Formation continue et accompagnement", "Coordination avec les services transverses"] },
      { role: "Agent KYC/B & D√©p√¥t de Capital", company: "Odity Andraharo | D√©c 2018 ‚Üí Mai 2020", tasks: ["V√©rification des pi√®ces justificatives clients et entreprises", "Coordination avec les √©quipes juridiques et bancaires", "Conformit√© r√©glementaire (KYC / LCB-FT)", "Gestion des cas sensibles et am√©lioration continue"] }
    ],

    skillsTitle: "MON ARSENAL TECHNIQUE",
    skills: [
      { title: "üõ†Ô∏è Techniques & Outils", list: ["Excel avanc√© : formules complexes, Power Query, macros VBA", "Power BI : dashboards, DAX, mod√©lisation de donn√©es", "SQL : requ√™tes, gestion et structuration de bases de donn√©es", "Microsoft 365 : √âcosyst√®me collaboratif (SharePoint, Teams, Power Automate)", "Langages en apprentissage : HTML, CSS, JavaScript, Python (Data Science)"] },
      { title: "üìä Analyse & Reporting", list: ["Conception & Fiabilisation : Automatisation de reportings et garantie de l'int√©grit√© des donn√©es (Data Quality)", "Suivi et interpr√©tation de KPI strat√©giques", "Data Storytelling : Traduction visuelle de la donn√©e pour captiver et convaincre.", "Audit & Diagnostic : D√©tection d‚Äôanomalies et mise en lumi√®re de leviers d‚Äôaction"] },
      { title: "üë• Management & Leadership", list: ["Supervision et coordination d‚Äô√©quipes", "Supervision & Coh√©sion : Coordination d‚Äô√©quipes multiculturelles et agiles", "Accompagnement au changement : Formation et acculturation des √©quipes aux nouveaux outils.", "Pilotage de Performance : Optimisation du capital humain et mont√©e en comp√©tence.", "Arbitrage Strat√©gique : R√©solution de probl√®mes complexes et gestion des priorit√©s.", "Ing√©nierie de D√©cision : D√©finition des r√¥les, responsabilit√©s et circuits de validation"] },
      { title: "üåü Soft Skills", list: ["Esprit analytique & sens critique : Capacit√© √† d√©composer la complexit√© et √† questionner l'existant", "Autonomie & adaptabilit√© : Efficacit√© imm√©diate dans des environnements mouvants.", "Communication claire, structur√©e et impactante : Savoir transmettre l'essentiel pour engager l'action", "Vision strat√©gique & prise de d√©cision √©clair√©e : Voir plus loin pour d√©cider mieux.", "Curiosit√© et apprentissage continu : Une veille permanente pour int√©grer les innovations de demain.", "R√©silience & gestion du stress en contexte complexe : Garder le cap et la pr√©cision sous haute pression.", "N√©gociation, diplomatie & influence constructive : Aligner les int√©r√™ts pour faire avancer les projets.", "Cr√©ativit√© & innovation orient√©e solution : Penser \"hors du cadre\" pour r√©soudre des probl√®mes concrets.", "Sens de la priorisation & gestion du temps : Maximiser la valeur de la monnaie centrale de mon √©gosyst√®me", "Intelligence situationnelle & √©coute active : Comprendre les besoins profonds derri√®re les demandes formul√©es."] }
    ],

    connectionTitle: "CONTACTEZ-MOI",
    connectionText: "Curieux de collaborer ou simplement d‚Äô√©changer sur vos enjeux strat√©giques ? Connectons-nous.",
    btnDownload: "T√©l√©charger mon CV",
    btnSend: "Envoyer le message"
  },
  
  en: {
  navHome: "Home",
  navAbout: "Biography",
  navPassion: "Passion",
  navStrategy: "Vision",
  navSkills: "Skills",
  navExperience: "Professional Background",
  navConnection: "Contact",
  
  greetingName: "Hello,\nI am Aina Mahery,",
  greetingRole: "Strategic analyst, solutions creator and passionate about sustainable performance.",
  greetingDescription: "I've forged my expertise in the field. From advisor to team leader, including coaching and supervision, I've redefined each rung to extract a physical law: performance only lasts if it is structured.<br><br>Today, I operate where data becomes a language of action. I design systems that illuminate blind spots and transform raw information into pure decision.<br><br><strong>Welcome to my egosystem.</strong> It's a value proposition where technical rigor serves intentional impact. Let's think, build and act together.",
  
  aboutTitle: "MY EGOSYSTEM",
  aboutText: "Specialist in reporting and performance, I have supported more than 20 international brands to transform their data into immediate levers of action.<br><b>My golden rule :</b> I do not produce aesthetics to \"beautify\" slides. I build tools to turn data into decisions.<br><br>My architecture rests on three specialized organs :<br><ul><li><strong>Fine Analysis :</strong> Interpreting weak signals, not just displaying numbers.</li><li><strong>Optimization :</strong> Streamlining business processes so that structure serves action.</li><li><strong>Human Steering :</strong> Because data only has value through the intelligence of those who activate it.</li></ul><br>My objective : That each dashboard is a strategic engine, each limit an opportunity to surpass, and each commitment a performance executed with precision.",
  
  passionTitle: "MY THINKING ENGINE",
  passionDescription: "My egosystem does not stop at the office. It feeds on influences that transform my strategic vision.<br><ul><li>üéÆ <b>Gaming & Strategy:</b> The art of branching thinking. Modeling scenarios, anticipating risks, and improvising.</li><li>üíª <b>Code & Logic:</b> My personal laboratory. Mastering the invisible structure behind every interface.</li><li>üéå <b>Japanese Culture:</b> Rigor, clean aesthetics, and the philosophy of Kaizen (continuous improvement).</li><li>üéß <b>Music & Rhythm:</b> The metronome of my productivity. It sets the pace of my cycles.</li><li>‚ôüÔ∏è <b>Chess:</b> The ground of pure thinking. Anticipating several moves, developing strategies, and turning each game into tactical learning.</li></ul>Far from being mere hobbies, they constitute my continuous learning infrastructure.",
  
  strategicTitle: "MY STRATEGIC ARCHITECTURE",
  strategicText: "My expertise does not come from manuals, it was forged by an obsession with results. I do not merely follow rules: I create principles and design systems.",
  architecture: [
   { id: "vision", title: "üëÅÔ∏è‚Äçüó®Ô∏è Vision", content: "<b>Data as language.</b> My journey has taught me to read between the lines. I do not handle numbers: I reveal intentions. Each dashboard is a narrative lever, structured to turn raw data into strategic language." },
    { id: "ambition", title: "üöÄ Ambition", content: "<b>Human-centered analysis.</b> Data without humans is dead. My aim is to turn analysis into concrete action where processes are chosen, making the human factor a driving force and not a variable to adjust." },
    { id: "demarche", title: "‚öôÔ∏è Approach", content: "<b>Taming complexity.</b> Where others see constraints, I see a playground. I design tools that are decision triggers. My signature: make the complex readable, fluid and sustainable." },
    { id: "engagement", title: "üîí Commitment", content: "<b>Anticipate to impact.</b> I have led multicultural teams. My commitment is a practice: I anticipate and structure where others improvise, guaranteeing a real, measurable and ethical impact." },
    { id: "reperes", title: "üß≠ Landmarks", content: "<b>Rigor and Integrity.</b> Excellence is my daily requirement. Every optimization I deliver aims for identifiable and responsible value, anchored in an integrity that defines how I steer and influence." },
    { id: "signature", title: "üß† Signature", content: "<b>Technicality in the service of meaning.</b> My creations catalyze decisions. My work is not satisfied with being efficient: it leaves a lasting imprint where performance meets meaning." }
  ],

  experienceTitle: "MY KEY STAGES",
  experience: [
    { role: "Reporting & Data Analysis ‚Äì Performance", company: "Odity Andraharo | June 2023 ‚Üí present", tasks: ["Data analysis & KPI monitoring to guide decisions", "Creation & automation of reportings (daily, weekly, monthly)", "Design of dynamic and visual dashboards", "Collaboration with teams to optimize processes & performance"] },
    { role: "Team Supervisor ‚Üí Team Leader", company: "Odity Andraharo | Dec 2020 ‚Üí May 2023", tasks: ["Operational management and supervision of a team", "Coordination of activity and resolution of complex cases", "Continuous training & support", "Continuous improvement of processes"] },
    { role: "Coach Trainer", company: "Odity Andraharo | June 2020 ‚Üí Dec 2020", tasks: ["Performance follow-up respecting quality & compliance", "Operational supervision and priority management", "Continuous training and support", "Coordination with transversal services"] },
    { role: "KYC/B Agent & Capital Deposit", company: "Odity Andraharo | Dec 2018 ‚Üí May 2020", tasks: ["Verification of client and company supporting documents", "Coordination with legal and banking teams", "Regulatory compliance (KYC / AML-CFT)", "Management of sensitive cases and continuous improvement"] }
  ],

  skillsTitle: "MY TECHNICAL ARSENAL",
  skills: [
{ title: "üõ†Ô∏è Techniques & Tools", list: ["Advanced Excel: complex formulas, Power Query, VBA macros", "Power BI: dashboards, DAX, data modeling", "SQL: queries, database management and structuring", "Microsoft 365: Collaborative ecosystem (SharePoint, Teams, Power Automate)", "Languages in learning: HTML, CSS, JavaScript, Python (Data Science)"] },
{ title: "üìä Analysis & Reporting", list: ["Design & Reliability: Automation of reportings and ensuring data integrity (Data Quality)", "Monitoring and interpretation of strategic KPIs", "Data Storytelling: Visual translation of data to captivate and convince.", "Audit & Diagnosis: Detection of anomalies and highlighting action levers"] },
{ title: "üë• Management & Leadership", list: ["Supervision and coordination of teams", "Supervision & Cohesion: Coordination of multicultural and agile teams", "Change Support: Training and acculturation of teams to new tools.", "Performance Management: Optimization of human capital and skills development.", "Strategic Arbitration: Resolution of complex problems and priority management.", "Decision Engineering: Definition of roles, responsibilities, and approval workflows"] },
{ title: "üåü Soft Skills", list: ["Analytical mindset & critical thinking: Ability to decompose complexity and question the existing", "Autonomy & adaptability: Immediate effectiveness in changing environments.", "Clear, structured and impactful communication: Knowing how to convey essentials to drive action", "Strategic vision & informed decision-making: Seeing further to decide better.", "Curiosity and continuous learning: Permanent monitoring to integrate tomorrow's innovations.", "Resilience & stress management in complex contexts: Staying on course and precise under high pressure.", "Negotiation, diplomacy & constructive influence: Aligning interests to advance projects.", "Creativity & solution-oriented innovation: Thinking 'outside the box' to solve concrete problems.", "Sense of prioritization & time management: Maximizing the value of the central currency of my egosystem", "Situational intelligence & active listening: Understanding the deep needs behind expressed requests."] }  ],

  connectionTitle: "CONTACT ME",
  connectionText: "Curious to collaborate or simply to discuss your strategic issues? Let's connect.",
  btnDownload: "Download my CV",
  btnSend: "Send the message"


  } 
};

const dom = {
  navHome: () => document.getElementById('nav-home'),
  navAbout: () => document.getElementById('nav-about'),
  navPassion: () => document.getElementById('nav-passion'),
  navStrategy: () => document.getElementById('nav-strategy'),
  navSkills: () => document.getElementById('nav-skills'),
  navExperience: () => document.getElementById('nav-experience'),
  navConnection: () => document.getElementById('nav-connection'),
  greetingName: () => document.getElementById('greeting-name'),
  greetingRole: () => document.getElementById('greeting-role'),
  greetingDescription: () => document.getElementById('greeting-description'),
  aboutTitle: () => document.getElementById('about-title'),
  aboutText: () => document.getElementById('about-text'),
  passionTitle: () => document.getElementById('passion-title'),
  passionDescription: () => document.getElementById('passion-description'),
  strategicTitle: () => document.getElementById('strategic-title'),
  strategicText: () => document.getElementById('strategic-text'),
  archButtons: () => document.getElementById('arch-buttons'),
  archContent: () => document.getElementById('arch-content'),
  experienceTitle: () => document.getElementById('experience-title'),
  experienceList: () => document.getElementById('experience-list'),
  skillsTitle: () => document.getElementById('skills-title'),
  skillsList: () => document.getElementById('skills-list'),
  connectionTitle: () => document.getElementById('connection-title'),
  connectionText: () => document.getElementById('connection-text'),
  downloadBtns: () => document.querySelectorAll('.download-cv'),
  submitBtn: () => document.querySelector('#contact-form button[type="submit"]'),
  langButtons: () => document.querySelectorAll('.lang-switch [data-lang]')
};

const safeText = (el, text) => {
  if (!el) return;
  el.textContent = text ?? '';
};

const sanitizeHTML = (html) => {
  if (!html) return '';
  const template = document.createElement('template');
  template.innerHTML = html;
  template.content.querySelectorAll('script, iframe, object, embed').forEach(n => n.remove());
  const walker = document.createTreeWalker(template.content, NodeFilter.SHOW_ELEMENT);
  while (walker.nextNode()) {
    const node = walker.currentNode;
    [...node.attributes].forEach(attr => {
      if (/^on/i.test(attr.name) || (attr.name === 'href' && /^javascript:/i.test(attr.value))) {
        node.removeAttribute(attr.name);
      }
    });
  }
  return template.innerHTML;
};

const safeHTML = (el, html) => {
  if (!el) return;
  el.innerHTML = sanitizeHTML(html);
};

const detectBrowserLang = () => {
  const lang = navigator.languages?.[0] || navigator.language || 'fr';
  const short = lang.slice(0, 2).toLowerCase();
  return short === 'en' ? 'en' : 'fr';
};

let currentLang = detectBrowserLang();

const initPortfolio = () => {
  const langBtns = dom.langButtons();
  if (langBtns && langBtns.length) {
    langBtns.forEach(btn => {
      btn.addEventListener('click', () => setLanguage(btn.getAttribute('data-lang')));
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });
  }
  setLanguage(currentLang);
};

const setLanguage = (lang) => {
  currentLang = lang || 'fr';
  const data = portfolioData[currentLang] || portfolioData['fr'];

  safeText(dom.navHome(), data.navHome);
  safeText(dom.navAbout(), data.navAbout);
  safeText(dom.navPassion(), data.navPassion);
  safeText(dom.navStrategy(), data.navStrategy);
  safeText(dom.navSkills(), data.navSkills);
  safeText(dom.navExperience(), data.navExperience);
  safeText(dom.navConnection(), data.navConnection);

  if (dom.greetingName()) dom.greetingName().innerHTML = (data.greetingName || '').replace(/\n/g, '<br>');
  safeText(dom.greetingRole(), data.greetingRole);
  safeHTML(dom.greetingDescription(), data.greetingDescription);

  safeText(dom.aboutTitle(), data.aboutTitle);
  safeHTML(dom.aboutText(), data.aboutText);

  safeText(dom.passionTitle(), data.passionTitle);
  safeHTML(dom.passionDescription(), data.passionDescription);

  safeText(dom.strategicTitle(), data.strategicTitle);
  safeHTML(dom.strategicText(), data.strategicText);

  safeText(dom.experienceTitle(), data.experienceTitle);
  safeText(dom.skillsTitle(), data.skillsTitle);
  safeText(dom.connectionTitle(), data.connectionTitle);
  safeText(dom.connectionText(), data.connectionText);

  dom.downloadBtns() && dom.downloadBtns().forEach(b => b.textContent = data.btnDownload);

  const submit = dom.submitBtn();
  if (submit) submit.textContent = data.btnSend;

  renderArchitecture(data.architecture || []);
  renderExperience(data.experience || []);
  renderSkills(data.skills || []);

  const buttons = dom.langButtons();
  if (buttons && buttons.length) {
    buttons.forEach(b => {
      const isActive = b.getAttribute('data-lang') === currentLang;
      b.classList.toggle('active', isActive);
      b.setAttribute('aria-pressed', String(isActive));
    });
  }
};

const renderArchitecture = (archData) => {
  const btnContainer = dom.archButtons();
  const contentContainer = dom.archContent();
  if (!btnContainer || !contentContainer) return;
  btnContainer.innerHTML = '';
  contentContainer.innerHTML = '';

  if (!archData.length) {
    contentContainer.textContent = '';
    return;
  }

  const frag = document.createDocumentFragment();

  archData.forEach((item, index) => {
    const btn = document.createElement('button');
    btn.className = `arch-btn`;
    btn.type = 'button';
    btn.setAttribute('data-id', item.id || index);
    btn.textContent = item.title;
    btn.setAttribute('aria-pressed', index === 0 ? 'true' : 'false');
    btn.tabIndex = 0;

    btn.addEventListener('click', () => {
      btnContainer.querySelectorAll('.arch-btn').forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');
      contentContainer.innerHTML = `<div class="arch-content-box">${sanitizeHTML(item.content)}</div>`;
    });

    btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        btn.click();
      }
    });

    if (index === 0) btn.classList.add('active');

    frag.appendChild(btn);
  });

  btnContainer.appendChild(frag);
  contentContainer.innerHTML = `<div class="arch-content-box">${sanitizeHTML(archData[0].content)}</div>`;
};

const renderExperience = (expData) => {
  const container = dom.experienceList();
  if (!container) return;
  container.innerHTML = '';

  if (!Array.isArray(expData) || expData.length === 0) {
    container.innerHTML = '<p>Aucune exp√©rience renseign√©e.</p>';
    return;
  }

  const frag = document.createDocumentFragment();

  expData.forEach(item => {
    const itemWrap = document.createElement('div');
    itemWrap.className = 'accordion-item';

    const header = document.createElement('div');
    header.className = 'accordion-header';
    header.tabIndex = 0;
    header.setAttribute('role', 'button');
    header.setAttribute('aria-expanded', 'false');

    header.innerHTML = `
      <div>
        <b>${item.role}</b><br>
        <small style="color: var(--text-secondary);">${item.company}</small>
      </div>
    `;

    const icon = document.createElement('span');
    icon.textContent = '‚ûï';
    header.appendChild(icon);

    const body = document.createElement('div');
    body.className = 'accordion-body';
    body.innerHTML = `<ul>${(item.tasks || []).map(t => `<li>${t}</li>`).join('')}</ul>`;

    body.classList.remove('active');

    const toggle = () => {
      const expanded = header.getAttribute('aria-expanded') === 'true';
      container.querySelectorAll('.accordion-header').forEach(h => h.setAttribute('aria-expanded', 'false'));
      container.querySelectorAll('.accordion-body').forEach(b => b.classList.remove('active'));
      container.querySelectorAll('.accordion-header span').forEach(s => s.textContent = '‚ûï');

      if (!expanded) {
        header.setAttribute('aria-expanded', 'true');
        body.classList.add('active');
        icon.textContent = '‚ûñ';
      } else {
        header.setAttribute('aria-expanded', 'false');
        body.classList.remove('active');
        icon.textContent = '‚ûï';
      }
    };

    header.addEventListener('click', toggle);
    header.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggle();
      }
    });

    itemWrap.appendChild(header);
    itemWrap.appendChild(body);
    frag.appendChild(itemWrap);
  });

  container.appendChild(frag);
};

const renderSkills = (skillsData) => {
  const container = dom.skillsList();
  if (!container) return;
  container.innerHTML = '';

  if (!Array.isArray(skillsData) || skillsData.length === 0) {
    container.innerHTML = '<p>Aucune comp√©tence renseign√©e.</p>';
    return;
  }

  const frag = document.createDocumentFragment();

  skillsData.forEach(skill => {
    const li = document.createElement('li');
    li.className = 'skill-card';
    li.setAttribute('tabindex', '0');
    li.setAttribute('role', 'group');
    li.setAttribute('aria-expanded', 'false');

    const header = document.createElement('div');
    header.className = 'skill-card-header';
    header.innerHTML = `<h4>${skill.title}</h4>`;

    const icon = document.createElement('span');
    icon.className = 'skill-card-icon';
    icon.textContent = '‚ñº';
    header.appendChild(icon);

    const content = document.createElement('div');
    content.className = 'skill-card-content';
    content.innerHTML = `<ul>${(skill.list || []).map(s => `<li>${s}</li>`).join('')}</ul>`;

    const toggle = () => {
      const isActive = li.classList.contains('active');
      container.querySelectorAll('.skill-card').forEach(c => {
        c.classList.remove('active');
        c.setAttribute('aria-expanded', 'false');
        c.querySelector('.skill-card-icon') && (c.querySelector('.skill-card-icon').textContent = '‚ñº');
      });

      if (!isActive) {
        li.classList.add('active');
        li.setAttribute('aria-expanded', 'true');
        icon.textContent = '‚ñ≤';
      } else {
        li.classList.remove('active');
        li.setAttribute('aria-expanded', 'false');
        icon.textContent = '‚ñº';
      }
    };

    header.addEventListener('click', toggle);
    header.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggle();
      }
    });
    li.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggle();
      }
    });

    li.appendChild(header);
    li.appendChild(content);
    frag.appendChild(li);
  });

  container.appendChild(frag);
};

document.addEventListener('DOMContentLoaded', initPortfolio);

window.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('menu-toggle');
    const side = document.querySelector('header');

    if (btn && side) {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            side.classList.toggle('active');
            
            if (side.classList.contains('active')) {
                btn.innerText = "FERMER";
            } else {
                btn.innerText = "MENU";
            }
        });

        const links = document.querySelectorAll('.nav-links a');
        links.forEach(l => {
            l.addEventListener('click', () => {
                side.classList.remove('active');
                btn.innerText = "MENU";
            });
        });

        document.addEventListener('click', (e) => {
            if (!side.contains(e.target) && !btn.contains(e.target)) {
                side.classList.remove('active');
                btn.innerText = "MENU";
            }
        });
    } else {
        console.error("Le bouton ou le header n'a pas √©t√© trouv√© dans le DOM");
    }
});
(function() {
  const buttons = document.querySelectorAll('.download-cv');
  if (!buttons.length) return;

  const files = {
    fr: 'Aina-Mahery-CV_FR.pdf',
    en: 'Aina-Mahery-CV_EN.pdf'
  };

  const getLangFromUI = () => {
    if (typeof currentLang !== 'undefined' && currentLang) {
      return String(currentLang).slice(0,2).toLowerCase();
    }
    const select = document.getElementById('lang-select');
    if (select) return select.value.slice(0,2).toLowerCase();
    const active = document.querySelector('.lang-switch button.active');
    if (active) return active.textContent.trim().slice(0,2).toLowerCase();
    return 'fr';
  };

  const downloadByAnchor = (fileUrl, fileName) => {
    const a = document.createElement('a');
    a.href = fileUrl;
    a.setAttribute('download', fileName || '');
    document.body.appendChild(a);
    a.click();
    a.remove();
  };

  const handler = (e) => {
    e && e.preventDefault();
    const lang = getLangFromUI() === 'en' ? 'en' : 'fr';
    const fileName = files[lang];
    const fileUrl = new URL(fileName, window.location.href).href;
    downloadByAnchor(fileUrl, fileName);
  };

  buttons.forEach(btn => {
    btn.setAttribute('type', 'button');
    btn.tabIndex = 0;
    btn.addEventListener('click', handler);
    btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.code === 'Space' || e.key === ' ') {
        e.preventDefault();
        handler(e);
      }
    });
  });
})();
(function() {
  const form = document.getElementById('contact-form');
  if (!form) return;

  let statusEl = document.getElementById('form-status');
  if (!statusEl) {
    statusEl = document.createElement('div');
    statusEl.id = 'form-status';
    statusEl.setAttribute('role', 'status');
    statusEl.setAttribute('aria-live', 'polite');
    statusEl.style.position = 'absolute';
    statusEl.style.left = '-9999px';
    form.appendChild(statusEl);
  }

  const messages = {
    fr: {
      sending: "Envoi en cours...",
      sent: "Message envoy√© !",
      error: "Erreur lors de l'envoi. R√©essayez.",
      network: "Erreur r√©seau. V√©rifiez votre connexion.",
      invalidEmail: "Veuillez fournir une adresse email valide.",
      spamDetected: "Soumission suspecte d√©tect√©e."
    },
    en: {
      sending: "Sending...",
      sent: "Message sent!",
      error: "Error sending message. Please try again.",
      network: "Network error. Check your connection.",
      invalidEmail: "Please provide a valid email address.",
      spamDetected: "Suspicious submission detected."
    }
  };

  const isValidEmail = (email) => {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  };

  form.addEventListener('submit', async function(event) {
    event.preventDefault();

    const lang = typeof currentLang !== 'undefined' ? currentLang : 'fr';
    const msg = messages[lang] || messages.fr;

    const submitButton = form.querySelector('button[type="submit"]');
    const originalButtonText = submitButton ? submitButton.innerText : null;

    const honeypot = form.querySelector('input[name="hp"]');
    if (honeypot && honeypot.value) {
      statusEl.textContent = msg.spamDetected;
      return;
    }

    const name = (form.elements['name'] && form.elements['name'].value || '').trim();
    const email = (form.elements['email'] && form.elements['email'].value || '').trim();
    const message = (form.elements['message'] && form.elements['message'].value || '').trim();

    if (!isValidEmail(email)) {
      statusEl.textContent = msg.invalidEmail;
      return;
    }

    if (submitButton) {
      submitButton.disabled = true;
      submitButton.innerText = msg.sending;
      submitButton.setAttribute('aria-busy', 'true');
    }

    statusEl.textContent = msg.sending;

    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 15000);

    try {
      const formData = new FormData(form);
      formData.append("access_key", "12270239-d6b1-43f2-bc7a-b85f1687412e");

      const resp = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData,
        signal: controller.signal,
      });

      clearTimeout(timeout);

      if (!resp.ok) {
        console.error('HTTP error', resp.status);
        statusEl.textContent = msg.error;
        throw new Error('HTTP ' + resp.status);
      }

      const data = await resp.json();

      if (data.success) {
        statusEl.textContent = msg.sent;
        form.reset();
        if (submitButton) submitButton.innerText = msg.sent;
        setTimeout(() => {
          if (submitButton) {
            submitButton.innerText = originalButtonText || (portfolioData?.[lang]?.btnSend || 'Envoyer');
            submitButton.disabled = false;
            submitButton.removeAttribute('aria-busy');
          }
        }, 3000);
      } else {
        console.error('API error', data);
        statusEl.textContent = data.message || msg.error;
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerText = originalButtonText || (portfolioData?.[lang]?.btnSend || 'Envoyer');
          submitButton.removeAttribute('aria-busy');
        }
      }
    } catch (err) {
      clearTimeout(timeout);
      console.error('Fetch error:', err);
      statusEl.textContent = (err.name === 'AbortError') ? msg.network : msg.network;
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.innerText = originalButtonText || (portfolioData?.[lang]?.btnSend || 'Envoyer');
        submitButton.removeAttribute('aria-busy');
      }
    }
  });
})();
